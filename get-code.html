<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kai BOT - Get Code</title>
    <link rel="icon" href="Kai.png" type="image/png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }
        .code-container {
    background-color: #fff;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    max-width: 500px;
    width: 100%;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.code-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

.code-container p {
    font-size: 20px;
    color: #555;
    margin: 12px 0;
}

.code-container .generated-code {
    font-size: 28px;
    font-weight: bold;
    color: #0066cc;
    word-wrap: break-word;
}
    </style>
</head>
<body>

<div class="code-container" id="codeContainer">
    <p>Click anywhere to copy the code!</p>
    <p class="generated-code" id="generatedCode">Loading...</p>
</div>

<script>
    function generateRandomString(length) {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < length; i++) {
        result += characters.charAt(Math.floor(Math.random() * characters.length));
    }
    return result;
}

// Hàm kiểm tra xem mã code đã hết hạn (24 giờ chưa)
function isCodeExpired(timestamp) {
    const currentTime = new Date().getTime();
    const timeDifference = currentTime - timestamp;
    const oneDay = 24 * 60 * 60 * 1000; // 24 giờ = 86400000 ms
    return timeDifference > oneDay;
}

// Lấy user_id từ URL
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('user');

if (userId) {
    // Kiểm tra xem có mã code đã lưu trong localStorage cho user_id này chưa
    let storedData = localStorage.getItem(userId);

    if (storedData) {
        // Lấy mã code và thời gian lưu từ localStorage
        storedData = JSON.parse(storedData);
        
        // Nếu mã code đã hết hạn, tạo mã mới
        if (isCodeExpired(storedData.timestamp)) {
            storedData.code = generateRandomString(16); // Tạo mã dài 16 ký tự
            storedData.timestamp = new Date().getTime(); // Cập nhật thời gian tạo mã mới
            localStorage.setItem(userId, JSON.stringify(storedData)); // Lưu lại mã code mới
        }
    } else {
        // Nếu chưa có mã code, tạo mã mới
        storedData = {
            code: generateRandomString(16), // Tạo mã dài 16 ký tự
            timestamp: new Date().getTime() // Lưu thời gian tạo mã
        };
        localStorage.setItem(userId, JSON.stringify(storedData)); // Lưu mã code
    }

    // Hiển thị mã code 16 ký tự
    document.getElementById('generatedCode').textContent = storedData.code;

    // Hiển thị status và mã code
    const response = {
        status: "success",
        code: storedData.code
    };

    console.log(response); // In response ra console, có thể dùng API để gửi dữ liệu

    // Sao chép khi người dùng click vào phần tử
    document.getElementById('codeContainer').addEventListener('click', function () {
        const textarea = document.createElement('textarea');
        textarea.value = storedData.code;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert("Code đã được sao chép vào bộ nhớ tạm!");
    });
} else {
    document.getElementById('generatedCode').textContent = "User ID không hợp lệ!";
}
</script>

</body>
</html>
